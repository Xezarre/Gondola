"use strict";var __importStar=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var e in r)Object.hasOwnProperty.call(r,e)&&(t[e]=r[e]);return t.default=r,t};Object.defineProperty(exports,"__esModule",{value:!0});const util_1=require("util"),errors=__importStar(require("../errors")),util_2=require("./../util"),Appium=require("codeceptjs/lib/helper/Appium"),Locator=require("codeceptjs/lib/locator");class AppiumEx extends Appium{async _startBrowser(){await super._startBrowser(),this._isMultiRemote()&&(this.mainBrowser=this.browser)}async _after(){this._isMultiRemote()&&(this.browser=this.mainBrowser,this.$$=this.browser.$$.bind(this.browser)),await super._after()}async tap(r){if(this.isWeb)throw new errors.NotAppError;if(util_2.isEmpty(r))throw new errors.LocatorEmptyError;let t=[];if(0===(t=await this._locate(this._parseLocator.call(this,r),!0)).length)throw new errors.ElementNotFoundError(util_2.getLocatorString(r));{const r=t[0],e="tap";return this.browser.touchAction({action:e,element:r})}}async runOnAndroid(r,t){await super.runOnAndroid(r,t)}async runOnIOS(r,t){await super.runOnIOS(r,t)}async checkAppIsInstalled(r){await super.seeAppIsInstalled(r)}async switchDevice(r){if(!this._isMultiRemote())throw new errors.NotMultiremoteError;if(!this.mainBrowser||!this.mainBrowser.hasOwnProperty(r))throw new errors.DeviceNotFoundError(r);this.browser=this.mainBrowser[r],this.browser.$name=r,this.$$=this.browser.$$.bind(this.browser)}runOnAllDevices(){if(!this._isMultiRemote())throw new errors.NotMultiremoteError;this.browser=this.mainBrowser,this.$$=this.browser.$$.bind(this.browser)}getCurrentBrowser(){return this.browser}async getCapabilities(){return this.getCurrentBrowser().capabilities}async sendDeviceKeyEvent(r){if(util_1.isNullOrUndefined(r))throw new errors.GError(errors.GErrorKey.ArgKeyValueNotSet);const t="number"==typeof r?r.toString():r;return await super.sendDeviceKeyEvent(t)}async swipe(r,t,e){const i=await this.getElementBounds(r),s=i.left+i.width/2,o=i.top+i.height/2;await this.swipeByCoordinates(s,o,t,e)}async swipeByCoordinates(r,t,e,i){try{await this.browser.touchPerform([{action:"press",options:{x:r,y:t}},{action:"wait",options:{ms:500}},{action:"moveTo",options:{x:r+e,y:t+i}},{action:"release",options:{}}])}catch(r){if(r.name&&r.name.match(/invalid coordinates/gi))throw new errors.GError(errors.GErrorKey.SwipeOffofScreen);throw r}}async getElementBounds(r){let t=[];if(0===(t=this.isWeb?await this._locate(r):await this._locate(this._parseLocator.call(this,r))).length)throw new errors.ElementNotFoundError(util_2.getLocatorString(r));const e=t[0],i=await this._getElementLocation(e),s=i.x,o=i.y,a=await this._getElementSize(e);return{left:s,top:o,width:a.width,height:a.height}}async grabNumberOfVisibleElements(r){return this.isWeb?await super.grabNumberOfVisibleElements(r):await super.grabNumberOfVisibleElements(this._parseLocator.call(this,r))}async grabAttributeFrom(r,t){return this.isWeb?await super.grabAttributeFrom(r,t):await super.grabAttributeFrom(this._parseLocator.call(this,r),t)}async hideDeviceKeyboard(r,t){return await super.hideDeviceKeyboard(r,t)}async _getElementLocation(r){return await r.getLocation()}async _getElementSize(r){return await r.getSize()}_isMultiRemote(){return this.config.multiremote}_parseLocator(r){if(!r)return null;if("object"==typeof r){if(r.web&&this.isWeb)return this._parseLocator.call(this,r.web);if(r.android&&"android"===this.platform)return this._parseLocator.call(this,r.android);if(r.ios&&"ios"===this.platform)return this._parseLocator.call(this,r.ios)}if("string"==typeof r){if("~"===r[0])return r;if("//"===r.substr(0,2))return r;if("#"===r[0]&&!this.isWeb)return this._parseLocator.call(this,{id:r.slice(1)});if("android"===this.platform&&!this.isWeb)return`android=new UiSelector().text("${r}")`}if("css"===(r=new Locator(r,"xpath")).type&&!this.isWeb)throw new errors.GError(errors.GErrorKey.UsingCSSLocatorInApp);if("name"===r.type&&!this.isWeb)throw new errors.GError(errors.GErrorKey.UsingNameLocatorInNative);return"id"!==r.type||this.isWeb||"android"!==this.platform?r.simplify():`//*[@resource-id='${r.value}']`}}exports.AppiumEx=AppiumEx,module.exports=AppiumEx;
//# sourceMappingURL=../../debug/helper/AppiumEx.js.map
