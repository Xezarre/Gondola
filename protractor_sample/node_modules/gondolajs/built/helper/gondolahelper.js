"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const assert=__importStar(require("assert")),util_1=require("../util"),errors=__importStar(require("../errors")),message_1=require("../message"),recorder=codeceptjs.recorder,HELPERS_NAME=["Protractor","Puppeteer","WebDriverIO","Nightmare","Appium"],MOBILE_HELPER="Appium",jp=require("jsonpath"),ElementNotFound=require("codeceptjs/lib/helper/errors/ElementNotFound");class GondolaHelper extends Helper{async click(e,t){await this._getHelper().click(e,t)}async getElementCount(e){return await this._getHelper().grabNumberOfVisibleElements(e)}async getText(e){const t=await this._getHelper().grabTextFrom(e);return t instanceof Array?t[0]:t}async checkText(e,t){const r=await this.getText(e),a=message_1.localize(errors.GErrorKey.ValueNotMatch);assert.strictEqual(r,t,a)}async closeCurrentTab(){await this._getHelper().closeCurrentTab()}async closeOtherTabs(){await this._getHelper().closeOtherTabs()}async doesControlExist(e){try{return await this._getHelper().seeElement(e),!0}catch(e){if("Element locator cannot be empty."===e.message)throw e;return!1}}async enter(e,t){await this._getHelper().fillField(e,t)}async navigate(e){const t=this._getHelper(),r=t.browser;if(!r)throw new errors.BrowserNotFoundError;r.get?await r.get(e):await t.amOnPage(e)}async openNewTab(){await this._getHelper().openNewTab()}async checkWindowExist(e){await this._getHelper().seeTitleEquals(e)}async checkControlExist(e){await this._getHelper().seeElement(e)}async checkControlNotExist(e){await this._getHelper().dontSeeElement(e)}async waitForElement(e,t){this._assertTimeValue(t),await this._getHelper().waitForElement(e,t)}async deleteCookie(e){this._getHelper().clearCookie(e)}async executeScript(e){const t=this._getHelper();return await t.executeScript(e)}async maximize(){const e=this._getHelper();await e.resizeWindow("maximize")}async checkControlProperty(e,t,r){try{const a=await this.getControlProperty(e,t),o=message_1.localize(errors.GErrorKey.InvalidValue);assert.strictEqual(a,r,o)}catch(e){throw e}}async getControlProperty(e,t){const r=this._getHelper();if(!t)throw new errors.GError(errors.GErrorKey.PropertyNameEmpty);try{const a=await r.grabAttributeFrom(e,t);return a instanceof Array?a[0]:a}catch(e){throw e}}async getElementsAttribute(e,t){const r=this._getHelper();try{return await r.grabAttributeFrom(e,t)}catch(e){throw e}}async select(e,t){Array.isArray(t)||(t=[t]);const r=await this._locateSelectable(e);let a=[];a=r.$$?await r.$$("option"):await r.findElements({tagName:"option"});const o=await r.getAttribute("multiple");if("true"!==o&&1!==t.length)throw new errors.GError(errors.GErrorKey.InvalidMultiSelect);for(const e of a){const r=await e.getText(),a=await e.isSelected(),s=t.includes(r);if("true"===o)(!s&&a||s&&!a)&&e.click();else if(s&&!a){e.click();break}}}async getSelectedItems(e){const t=[],r=await this._locateSelectable(e);let a=[];a=r.$$?await r.$$("option"):await r.findElements({tagName:"option"});for(const e of a)await e.isSelected()&&t.push(e.getText());return Promise.all(t)}async setState(e,t){const r=this._getHelper(),a=await r._locateCheckable(e);if(!a.length)throw new errors.GError(errors.GErrorKey.CheckableElementNotFound,util_1.getLocatorString(e));if(!0!==t&&!1!==t)throw new errors.InvalidBooleanValueError(t);{const e=a[0];await e.isSelected()!==t&&await e.click()}}async get(e){const t=this._getHelper();return await t.grabValueFrom(e)}refresh(){this._getHelper().refreshPage()}async report(e,t){const r=this.helpers.Mochawesome;if(!r)throw new errors.MochawsomeCfNotFoundError;t?await r.addMochawesomeContext({title:""===e?"Untitled":e,value:t}):await r.addMochawesomeContext(e)}async clickPopup(e){if("string"!=typeof e)throw new errors.InvalidOptionValueError(e);{const t=this._getHelper();if("ok"===e.toLowerCase())await t.acceptPopup();else{if("cancel"!==e.toLowerCase())throw new errors.InvalidOptionValueError(e);await t.cancelPopup()}}}async getPopupText(){const e=this._getHelper(),t=await e.grabPopupText();if(null==t)throw new errors.GError(errors.GErrorKey.PopupNotFound);return t}async setPopupText(e){const t=this._getHelper();try{const r=await t.browser.switchTo().alert();r&&await r.sendKeys(e)}catch(e){throw e}}async setErrorHandler(e){this.onError=e}async wait(e){this._assertTimeValue(e),await this._getHelper().wait(e)}async switchFrame(e){await this._getHelper().switchTo(e)}async switchBrowserTab(e,t){if("previous"===e.toLowerCase())await this._getHelper().switchToPreviousTab(t);else{if("next"!==e.toLocaleLowerCase())throw new errors.InvalidOptionValueError(e);await this._getHelper().switchToNextTab(t)}}async saveScreenshot(e,t){await this._getHelper().saveScreenshot(e,t)}async _failed(e){if(this.onError){const t=recorder.add;recorder.add=((e,r,a=!1)=>{t.call(recorder,e,r,!0)}),recorder.session.start(GondolaHelper.name+" on _failed handler (start session)");const r={errorMessage:e.err.message,testCaseName:e.title,testStepName:this.currentStep.name};await this.onError(r,actor()),recorder.session.restore(GondolaHelper.name+" on _failed handler (restore session)"),recorder.add=t,this.onError=null}}async waitForDisappear(e,t){await this._getHelper().waitForDetached(e,t)}checkEqual(e,t,r){assert.deepStrictEqual(e,t,r)}checkNotEqual(e,t,r){assert.notDeepStrictEqual(e,t,r)}getJSONValue(e,t){return jp.query(e,"$"+t)}checkJSONValue(e,t,r){const a=this.getJSONValue(e,t);assert.deepStrictEqual(a,r)}async _beforeStep(e){this.currentStep=e}_findHelper(){for(const e in this.helpers)if(this.helpers.hasOwnProperty(e)){const t=e;if(HELPERS_NAME.includes(t))return this.helpers[t]}return null}async _gondolaLocate(e,t=!1){if(util_1.isEmpty(e))throw new errors.LocatorEmptyError;let r=[];return r=await this.helperLocate.call(this,e,t)}_getHelper(){if(!this.myhelper){if(this.myhelper=this._findHelper(),!this.myhelper)throw new errors.GError(errors.GErrorKey.HelperNotFound,`${HELPERS_NAME.join(";")}`);this.myhelper.helperLocate=this.myhelper._locate,this.myhelper._locate=this._gondolaLocate}return this.myhelper}async _locateSelectable(e){const t=this._getHelper(),r=await t._locate(e);if(!r.length)throw new errors.GError(errors.GErrorKey.SelectTagNotFound,util_1.getLocatorString(e));let a;for(const e of r){if("select"===await e.getTagName()){a=e;break}}if(!a)throw new errors.GError(errors.GErrorKey.InvalidSelectTag,util_1.getLocatorString(e));return a}_assertTimeValue(e){if(e&&(!Number.isInteger(e)||e<1))throw new errors.NegativeNumberError}}module.exports=GondolaHelper;
//# sourceMappingURL=../../debug/helper/gondolahelper.js.map
